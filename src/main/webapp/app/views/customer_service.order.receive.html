<div class="breadcrumbs">
    <!-- breadcrumbs goes here -->
    <ul class="breadcrumb">
        <li>
            <i class="ace-icon fa fa-home home-icon"></i>
            <a href="#">首页</a>
        </li>

        <li>
            <span>客服接单</span>
        </li>
        <li class="active">客户订单接收</li>
    </ul>
</div>

<div class="page-content" ng-controller="customerServiceOrderEditController">
<!-- setting box goes here if needed -->

<div class="page-header">
    <h1>
        客户订单接收
        <small>
            <i class="ace-icon fa fa-angle-double-right"></i>
            编辑订单
        </small>
    </h1>
</div>

<div class="row">
<div class="col-xs-12">
    <!-- page content goes here -->
    <ul class="wizard-steps">
        <li data-target="#step1" ng-class="{complete:(invoice.auditStatus>=40),active:(invoice.auditStatus<40)}">
            <span class="step">1</span>
            <span class="title">开单</span>
        </li>

        <li data-target="#step2" ng-class="{complete:(invoice.auditStatus>=60),active:( invoice.auditStatus>=40 && invoice.auditStatus<=50)}">
            <span class="step">2</span>
            <span class="title">仓库</span>
        </li>

        <li data-target="#step3" class="">
            <span class="step">3</span>
            <span class="title">打单</span>
        </li>

        <li data-target="#step4" class="">
            <span class="step">4</span>
            <span class="title">完成</span>
        </li>
    </ul>
    <hr>
    <form class="form-horizontal" name="form" novalidate ng-submit="submit()">
        <fieldset ng-disabled="success">
        <!--公司-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right"> 公司 </label>

            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <inc-select inc="invoice.inc"></inc-select>
                </div>
            </div>
        </div>

        <!--客户-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right"> 客户 </label>

            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <client-select client="invoice.client"></client-select>
                </div>
            </div>
        </div>

        <!--单据类型-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right"> 单据类型 </label>

            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <select class="form-control"  ng-model="invoice.invoiceType.invoiceTypeId">
                        <option value="1">销售</option>
                        <option value="3">自用</option>
                    </select>
                </div>
            </div>
        </div>

        <!--单据日期-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right"> 单据日期 </label>
            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <input type="text" class="form-control" datepicker-popup="yyyy/MM/dd"
                           show-button-bar="false" is-open="opened" datepicker-options=" {showWeeks: false, startingDay: 1 }"
                           ng-required="true" ng-click="opened = true"
                           ng-model="invoice.receivedDate"/>
                                <span class="input-group-addon">
                                <i class="fa fa-calendar bigger-110"></i>
                                </span>
                </div>
            </div>
        </div>

        <!--车号-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right"> 车号 </label>

            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <input class="form-control" type="text" ng-model="invoice.carNum">
                </div>
            </div>
        </div>

        <!--联系地址-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right"> 联系地址 </label>

            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <input class="form-control" type="text" ng-model="invoice.clientAddress">
                </div>
            </div>
        </div>

        <!--备注信息-->
        <div class="form-group">
            <label class="col-sm-3 control-label no-padding-right">备注信息</label>

            <div class="col-sm-9">
                <div class="input-group col-xs-10 col-sm-5">
                    <input class="form-control" type="text" ng-model="invoice.remark">
                </div>
            </div>
        </div>

        <h3 class="header smaller lighter blue">选择物料</h3>

        <div class="form-group">
            <div class="col-sm-4">
                <div class="input-group">
                    <input type="text" class="form-control search-query" placeholder="输入物料编码或者物料名称"
                           ng-model="materialSearchTerm">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-purple btn-sm" ng-click="search()">
                            搜索
                            <i class="ace-icon fa fa-search icon-on-right bigger-110"></i>
                        </button>
                    </span>
                </div>
            </div>
            <div class="col-sm-8">
                <div class="col-xs-11 label label-lg label-info arrowed-in arrowed-right">
                    <b>已选物料</b>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-4">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>物料编码</th>
                        <th>物料名称</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="material in data._embedded.materials">
                        <td class="align-middle">{{material.materialNum}}</td>
                        <td class="align-middle">{{material.name}}</td>
                        <td class="align-middle center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-xs btn-success" ng-click="add(material)">
                                    <i class="ace-icon fa fa-plus-circle bigger-120"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr ng-if="data == undefined || data.page.totalElements == 0">
                        <td colspan="3">无</td>
                    </tr>
                    <tr class="center" ng-if="loading">
                        <td colspan="7">
                            <i class="fa fa-spinner fa-spin bigger-210"></i>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-sm-8">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                    <tr>
                        <th>物料编码</th>
                        <th>订单数量</th>
                        <th>主计量单位</th>
                        <th>辅计量单位1</th>
                        <th>辅计量单位2</th>
                        <th>单价</th>
                        <th>金额</th>
                        <th>备注</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="invoiceDetail in invoice.invoiceDetails">
                        <td class="align-middle">{{invoiceDetail.material.materialNum}}</td>
                        <td class="align-middle">
                            <div class="ace-spinner touch-spinner" style="width: 120px;">
                                <div class="input-group">
                                    <input type="number" min="0"  class="input-mini spinner-input form-control"
                                           ng-model="invoiceDetail.orderCount">
                                </div>
                            </div>
                        </td>
                        <td class="align-middle">{{invoiceDetail.material.unit}}</td>
                        <td class="align-middle">{{(invoiceDetail.orderCount * invoiceDetail.material.conversionRateOne) | number:4}}
                            {{invoiceDetail.material.auxiliaryUnitOne}}
                        </td>
                        <td class="align-middle">{{(invoiceDetail.orderCount *  invoiceDetail.material.conversionRateTwo) | number:4}}
                            {{invoiceDetail.material.auxiliaryUnitTwo}}
                        </td>
                        <td class="align-middle">{{invoiceDetail.material.price}}</td>
                        <td class="align-middle">{{(invoiceDetail.orderCount*invoiceDetail.material.price) |number:2}}</td>
                        <td class="align-middle"><input class="input-sm" type="text" placeholder="备注"
                                                        ng-model="invoiceDetail.remark"></td>
                        <td class="align-middle">
                            <div class="btn-group">
                                <button type="button" class="btn btn-xs btn-danger" ng-click="remove(invoiceDetail.material.materialNum)">
                                    <i class="ace-icon fa fa-trash-o bigger-120"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr ng-if=" invoice.invoiceDetails == undefined ||  invoice.invoiceDetails.length == 0">
                        <td colspan="10">无</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="alert alert-success" ng-if="success">
            <!--<button type="button" class="close" data-dismiss="alert">-->
            <!--<i class="ace-icon fa fa-times"></i>-->
            <!--</button>-->
            <strong>
                <i class="ace-icon fa fa-check"></i>
                订单<span ng-if="invoice.auditStatus==40">提交</span><span ng-if="invoice.auditStatus==30">保存</span>成功!
            </strong>
            <br>
        </div>
        <div class="alert alert-danger" ng-if="error">
            <button type="button" class="close" data-dismiss="alert">
                <i class="ace-icon fa fa-times"></i>
            </button>
            <strong>
                <i class="ace-icon fa fa-check"></i>
                订单提交出错，请联系管理员!
            </strong>
            <br>
        </div>
        <div class="clearfix form-actions">
            <div class="col-md-offset-3 col-md-9">

                <button class="btn btn-info" type="submit" ng-click="invoice.auditStatus = 40">
                    <i class="ace-icon fa fa-check bigger-110"></i>
                    提交
                </button>

            </div>
        </div>
        </fieldset>
    </form>
</div>
<!-- /.col -->
</div>
<!-- /.row -->

</div>
<!-- /.page-content -->